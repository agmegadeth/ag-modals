!function(e){var t={overlayColor:"rgba(44, 55, 73, 0.9)",effect:"fade",video:!1,videoAjax:!1,width:null},o={init:function(o){var a=e.extend({},t,o);return this.data("agmodal",a),this.each(function(){var t=e(this),o=t.data("agmodal");if(!t.parent(".agmodal__wrapper").length){t.addClass("agmodal").addClass("agmodal--inited"),t.append('<a class="agmodal__close"></a>'),t.wrap('<div class="agmodal__wrapper" tabindex="-1"></div>');var a=t.parent(".agmodal__wrapper");t.addClass("agmodal--"+o.effect),null!==o.width&&t.css("width",o.width+"px"),o.video?t.addClass("agmodal--video"):null,a.css("background-color",o.overlayColor),e(document).trigger("agmodal.inited")}})},open:function(){var t=e(this),o=t.parent(".agmodal__wrapper"),a=t.data("agmodal");if(e("html").addClass("agmodal--lock"),o.addClass("agmodal__wrapper--visible"),t.addClass("agmodal--visible"),setTimeout(function(){e(".agmodal__wrapper--visible").focus()},400),a.video){var n=t.find("video").get(0);try{n.play()}catch(e){}}if(a.videoAjax)if(t.find("video").hasClass("downloaded")!==!0){var i=t.data("agvideo"),r=t.data("agposter"),l=t.data("agmb"),s='<video preload="auto" controls poster="'+r+'">';s+="</video>";var c="<div class='agmodal__video-preloader'><span></span></div>";t.prepend(s),t.prepend(c);var d=new XMLHttpRequest;d.open("GET",i,!0),d.responseType="blob",d.onprogress=function(t){var o=0;t.lengthComputable?(o=t.total,e(".agmodal__video-preloader span").text(parseInt(t.loaded/o*100,10)+"%")):(o=l,e(".agmodal__video-preloader span").text(parseInt(t.loaded/o*100,10)+"%"))},d.onload=function(){if(200==this.status){var e=t.find("video").get(0),o=this.response,a=window.URL.createObjectURL(o);console.log(o),e.src=a,t.find(".agmodal__video-preloader").remove(),e.oncanplay=function(){e.play()},t.find("video").addClass("downloaded")}},d.send()}else n.play();return t.trigger("agmodal.opened"),this},close:function(){var t=e(this),o=t.parent(".agmodal__wrapper"),a=t.data("agmodal");return t.removeClass("agmodal--visible"),o.removeClass("agmodal__wrapper--visible"),setTimeout(function(){e(".agmodal--visible").length||e("html").removeClass("agmodal--lock"),o.scrollTop(0)},400),a.video&&t.find("video").get(0).pause(),a.videoAjax&&(t.find("video").hasClass("downloaded")||(t.find("video").get(0).pause(),t.find("video").get(0).src="",t.find("video").get(0).load(),setTimeout(function(){t.find("video").remove()},1e3),xhr.abort())),t.trigger("agmodal.closed"),this}};e(window).on("load",function(){var t,o,a,n;t=e("html"),o=e(window).width(),t.addClass("agmodal--lock-test"),a=e(window).width(),t.removeClass("agmodal--lock-test"),n=a-o,e("<style type='text/css'>.agmodal--lock{margin-right:"+n+"px !important;}</style>").appendTo("head")}),e(document).ready(function(){e("*[data-ag]").click(function(t){t.preventDefault();var o=e(this).attr("data-ag"),a=e("#"+o);a.length&&a.hasClass("agmodal--inited")&&a.agmodal("open")})}),e(document).on("agmodal.inited",function(){e(".agmodal__close").click(function(){e(this).parent(".agmodal").agmodal("close")}),e(".agmodal__wrapper").click(function(){e(this).find(".agmodal").agmodal("close")}).children().click(function(e){e.stopPropagation()})}),e.fn.agmodal=function(t){return o[t]?o[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Метод "+t+" в jQuery.agmodal не существует"):o.init.apply(this,arguments)}}(jQuery);