!function(a){var o={overlayColor:"rgba(44, 55, 73, 0.9)",effect:"fade",video:!1,videoAjax:!1,width:null},e={init:function(e){var d=a.extend({},o,e);return this.data("agmodal",d),this.each(function(){var o=a(this),e=o.data("agmodal");if(!o.parent(".agmodal__wrapper").length){o.addClass("agmodal"),o.append('<a class="agmodal__close"></a>'),o.wrap('<div class="agmodal__wrapper" tabindex="-1"></div>');var d=o.parent(".agmodal__wrapper");o.addClass("agmodal--"+e.effect),null!==e.width&&o.css("width",e.width+"px"),e.video?o.addClass("agmodal--video"):null,d.css("background-color",e.overlayColor),a(document).trigger("agmodal.inited")}})},open:function(){var o=a(this),e=o.parent(".agmodal__wrapper"),d=o.data("agmodal");if(a("html").addClass("agmodal--lock"),e.addClass("agmodal__wrapper--visible"),o.addClass("agmodal--visible"),setTimeout(function(){a(".agmodal__wrapper--visible").focus()},400),d.video){var t=o.find("video").get(0);try{t.play()}catch(a){}}if(d.videoAjax)if(o.find("video").hasClass("downloaded")!==!0){var l=o.data("agvideo"),i=o.data("agposter"),n=o.data("agmb"),r='<video preload="auto" controls poster="'+i+'">';r+="</video>";var s="<div class='agmodal__video-preloader'><span></span></div>";o.prepend(r),o.prepend(s);var p=new XMLHttpRequest;p.open("GET",l,!0),p.responseType="blob",p.onprogress=function(o){var e=0;o.lengthComputable?(e=o.total,a(".agmodal__video-preloader span").text(parseInt(o.loaded/e*100,10)+"%")):(e=n,a(".agmodal__video-preloader span").text(parseInt(o.loaded/e*100,10)+"%"))},p.onload=function(){if(200==this.status){var a=o.find("video").get(0),e=this.response,d=window.URL.createObjectURL(e);console.log(e),a.src=d,o.find(".agmodal__video-preloader").remove(),a.oncanplay=function(){a.play()},o.find("video").addClass("downloaded")}},p.send()}else t.play();return o.trigger("agmodal.opened"),this},close:function(){var o=a(this),e=o.parent(".agmodal__wrapper"),d=o.data("agmodal");return o.removeClass("agmodal--visible"),e.removeClass("agmodal__wrapper--visible"),setTimeout(function(){a(".agmodal--visible").length||a("html").removeClass("agmodal--lock"),e.scrollTop(0)},400),d.video&&o.find("video").get(0).pause(),d.videoAjax&&(o.find("video").hasClass("downloaded")||(o.find("video").get(0).pause(),o.find("video").get(0).src="",o.find("video").get(0).load(),setTimeout(function(){o.find("video").remove()},1e3),xhr.abort())),o.trigger("agmodal.closed"),this}};a(window).on("load",function(){var o,e,d,t;o=a("html"),e=a(window).width(),o.addClass("agmodal--lock-test"),d=a(window).width(),o.removeClass("agmodal--lock-test"),t=d-e,a("<style type='text/css'>.agmodal--lock{margin-right:"+t+"px !important;}</style>").appendTo("head")}),a(document).ready(function(){a("*[data-ag]").click(function(o){o.preventDefault();var e=a(this).attr("data-ag"),d=a("#"+e);d.length&&d.agmodal("open")})}),a(document).on("agmodal.inited",function(){a(".agmodal__close").click(function(){a(this).parent(".agmodal").agmodal("close")}),a(".agmodal__wrapper").click(function(){a(this).find(".agmodal").agmodal("close")}).children().click(function(a){a.stopPropagation()})}),a.fn.agmodal=function(o){return e[o]?e[o].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof o&&o?void a.error("Метод "+o+" в jQuery.agmodal не существует"):e.init.apply(this,arguments)}}(jQuery);