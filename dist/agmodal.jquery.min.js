!function(a){var e={overlayColor:"rgba(44, 55, 73, 0.9)",effect:"fade",center:!1,video:!1,videoAjax:!1,width:null},o={init:function(o){var t=a.extend({},e,o);return this.data("agmodal",t),this.each(function(){var e=a(this),o=e.data("agmodal");if(!e.parent(".agmodal__wrapper").length){e.addClass("agmodal"),e.append('<a class="agmodal__close"></a>'),e.wrap('<div class="agmodal__wrapper" tabindex="-1"></div>');var t=e.parent(".agmodal__wrapper");e.addClass("agmodal--"+o.effect),null!==o.width&&e.css("width",o.width+"px"),o.video?e.addClass("agmodal--video"):null,o.center?t.addClass("agmodal__wrapper--center"):null,t.css("background-color",o.overlayColor),a(document).trigger("agmodal.inited")}})},open:function(){var e=a(this),o=e.parent(".agmodal__wrapper"),t=e.data("agmodal");if(a("html").addClass("agmodal--lock"),o.addClass("agmodal__wrapper--visible"),e.addClass("agmodal--visible"),e.agmodal("checkHeights"),setTimeout(function(){a(".agmodal__wrapper--visible").focus()},400),t.video){var d=e.find("video").get(0);try{d.play()}catch(a){}}if(t.videoAjax)if(e.find("video").hasClass("downloaded")!==!0){var i=e.data("agvideo"),l=e.data("agposter"),n=e.data("agmb"),r='<video preload="auto" controls poster="'+l+'">';r+="</video>";var s="<div class='agmodal__video-preloader'><span></span></div>";e.prepend(r),e.prepend(s);var p=new XMLHttpRequest;p.open("GET",i,!0),p.responseType="blob",p.onprogress=function(e){var o=0;e.lengthComputable?(o=e.total,a(".agmodal__video-preloader span").text(parseInt(e.loaded/o*100,10)+"%")):(o=n,a(".agmodal__video-preloader span").text(parseInt(e.loaded/o*100,10)+"%"))},p.onload=function(){if(200==this.status){var a=e.find("video").get(0),o=this.response,t=window.URL.createObjectURL(o);console.log(o),a.src=t,e.find(".agmodal__video-preloader").remove(),a.oncanplay=function(){a.play()},e.find("video").addClass("downloaded")}},p.send()}else d.play();return e.trigger("agmodal.opened"),this},close:function(){var e=a(this),o=e.parent(".agmodal__wrapper"),t=e.data("agmodal");return e.removeClass("agmodal--visible"),o.removeClass("agmodal__wrapper--visible"),setTimeout(function(){a(".agmodal--visible").length||a("html").removeClass("agmodal--lock"),o.scrollTop(0)},400),t.video&&e.find("video").get(0).pause(),t.videoAjax&&(e.find("video").hasClass("downloaded")||(e.find("video").get(0).pause(),e.find("video").get(0).src="",e.find("video").get(0).load(),setTimeout(function(){e.find("video").remove()},1e3),xhr.abort())),e.trigger("agmodal.closed"),this},checkHeights:function(){var e=a(this),o=e.parent(".agmodal__wrapper"),t=a(window).height(),d=e.outerHeight(),i=e.data("agmodal");return t<d+110?o.removeClass("agmodal__wrapper--center"):i.center&&o.addClass("agmodal__wrapper--center"),this}};a(window).on("load",function(){var e,o,t,d;e=a("html"),o=a(window).width(),e.addClass("agmodal--lock-test"),t=a(window).width(),e.removeClass("agmodal--lock-test"),d=t-o,a("<style type='text/css'>.agmodal--lock{margin-right:"+d+"px !important;}</style>").appendTo("head")}),a(window).on("resize",function(){try{a(".agmodal--visible").agmodal("checkHeights")}catch(a){}}),a(document).ready(function(){a("*[data-ag]").click(function(e){e.preventDefault();var o=a(this).attr("data-ag"),t=a("#"+o);t.agmodal("open")})}),a(document).on("agmodal.inited",function(){a(".agmodal__close").click(function(){a(this).parent(".agmodal").agmodal("close")}),a(".agmodal__wrapper").click(function(){a(this).find(".agmodal").agmodal("close")}).children().click(function(a){a.stopPropagation()})}),a.fn.agmodal=function(e){return o[e]?o[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void a.error("Метод "+e+" в jQuery.agmodal не существует"):o.init.apply(this,arguments)}}(jQuery);