!function(a){var e={init:function(e){var o=a.extend({overlayColor:"rgba(44, 55, 73, 0.9)",effect:"scale"},e);return this.each(function(){var e=a(this);if(!e.parent(".agmodal__wrapper").length){e.append('<a class="agmodal__close"></a>'),a(this).wrap('<div class="agmodal__wrapper" tabindex="-1"></div>'),e.addClass("agmodal--"+o.effect);var d=e.parent(".agmodal__wrapper");d.css("background-color",o.overlayColor),a(document).trigger("agmodal.inited")}})},open:function(){var e=a(this),o=e.parent(".agmodal__wrapper");if(a("html").addClass("agmodal--lock"),o.addClass("agmodal__wrapper--visible"),e.addClass("agmodal--visible"),setTimeout(function(){a(".agmodal__wrapper--visible").focus()},400),e.find("video").length){var d=e.find("video").get(0);d.play()}if(e.attr("data-video"))if(e.find("video").hasClass("downloaded")!==!0){var t=e.data("video"),l=e.data("poster"),i='<video preload="auto" controls poster="'+l+'">';i+="</video>";var n="<div class='agmodal__video-preloader'><span></span></div>";e.prepend(i),e.prepend(n),xhr=new XMLHttpRequest,xhr.open("GET",t,!0),xhr.responseType="blob",xhr.onprogress=function(e){var o=0;e.lengthComputable?(o=e.total,a(".agmodal__video-preloader span").text(parseInt(e.loaded/o*100,10)+"%")):(o=861e5,a(".agmodal__video-preloader span").text(parseInt(e.loaded/o*100,10)+"%"))},xhr.onload=function(){if(200==this.status){var a=e.find("video").get(0),o=this.response,d=window.URL.createObjectURL(o);console.log(o),a.src=d,e.find(".agmodal__video-preloader").remove(),a.oncanplay=function(){a.play()},e.find("video").addClass("downloaded")}},xhr.send()}else d.play();return e.trigger("agmodal.opened"),this},close:function(){var e=a(this),o=e.parent(".agmodal__wrapper");return e.removeClass("agmodal--visible"),o.removeClass("agmodal__wrapper--visible"),setTimeout(function(){a(".agmodal--visible").length||a("html").removeClass("agmodal--lock"),o.scrollTop(0)},400),e.find("video").length&&e.find("video").get(0).pause(),e.attr("data-video")&&(e.find("video").hasClass("downloaded")||(e.find("video").get(0).pause(),e.find("video").get(0).src="",e.find("video").get(0).load(),setTimeout(function(){e.find("video").remove()},1e3),xhr.abort(),a("html").animate({scrollTop:0},800),a("body").animate({scrollTop:0},800))),e.trigger("agmodal.closed"),this}};a(window).load(function(){var e,o,d,t;e=a("html"),o=a(window).width(),e.addClass("agmodal--lock-test"),d=a(window).width(),e.removeClass("agmodal--lock-test"),t=d-o,a("<style type='text/css'>.agmodal--lock{margin-right:"+t+"px !important;}</style>").appendTo("body")}),a(document).ready(function(){a("*[data-ag]").click(function(e){e.preventDefault();var o=a(this).attr("data-ag"),d=a("#"+o);d.agmodal("open")})}),a(document).on("agmodal.inited",function(){a(".agmodal__close").click(function(){a(this).parent(".agmodal").agmodal("close")}),a(".agmodal__wrapper").click(function(){a(this).find(".agmodal").agmodal("close")}).children().click(function(a){a.stopPropagation()})}),a.fn.agmodal=function(o){return e[o]?e[o].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof o&&o?void a.error("Метод "+o+" в jQuery.agmodal не существует"):e.init.apply(this,arguments)}}(jQuery);
