!function(e){var t={overlayColor:"rgba(44, 55, 73, 0.9)",effect:"fade",center:!1},n={init:function(n){return t=e.extend(t,n),this.each(function(){var n=e(this),o="";if(!n.parent(".agmodal__wrapper").length){n.append('<a class="agmodal__close"></a>'),t.center&&(o="agmodal__wrapper--center"),e(this).wrap('<div class="agmodal__wrapper '+o+' " tabindex="-1"></div>'),n.addClass("agmodal--"+t.effect);var r=n.parent(".agmodal__wrapper");r.css("background-color",t.overlayColor),e(document).trigger("agmodal.inited")}})},open:function(){var t=e(this),n=t.parent(".agmodal__wrapper");if(e("html").addClass("agmodal--lock"),n.addClass("agmodal__wrapper--visible"),t.addClass("agmodal--visible"),t.agmodal("checkHeights"),setTimeout(function(){e(".agmodal__wrapper--visible").focus()},400),t.find("video").length){var o=t.find("video").get(0);o.play()}if(t.attr("data-video"))if(t.find("video").hasClass("downloaded")!==!0){var r=t.data("video"),i=t.data("poster"),a='<video preload="auto" controls poster="'+i+'">';a+="</video>";var s="<div class='agmodal__video-preloader'><span></span></div>";t.prepend(a),t.prepend(s);var l=new XMLHttpRequest;l.open("GET",r,!0),l.responseType="blob",l.onprogress=function(t){var n=0;t.lengthComputable?(n=t.total,e(".agmodal__video-preloader span").text(parseInt(t.loaded/n*100,10)+"%")):(n=861e5,e(".agmodal__video-preloader span").text(parseInt(t.loaded/n*100,10)+"%"))},l.onload=function(){if(200==this.status){var e=t.find("video").get(0),n=this.response,o=window.URL.createObjectURL(n);console.log(n),e.src=o,t.find(".agmodal__video-preloader").remove(),e.oncanplay=function(){e.play()},t.find("video").addClass("downloaded")}},l.send()}else o.play();return t.trigger("agmodal.opened"),this},close:function(){var t=e(this),n=t.parent(".agmodal__wrapper");return t.removeClass("agmodal--visible"),n.removeClass("agmodal__wrapper--visible"),setTimeout(function(){e(".agmodal--visible").length||e("html").removeClass("agmodal--lock"),n.scrollTop(0)},400),t.find("video").length&&t.find("video").get(0).pause(),t.attr("data-video")&&(t.find("video").hasClass("downloaded")||(t.find("video").get(0).pause(),t.find("video").get(0).src="",t.find("video").get(0).load(),setTimeout(function(){t.find("video").remove()},1e3),xhr.abort(),e("html").animate({scrollTop:0},800),e("body").animate({scrollTop:0},800))),t.trigger("agmodal.closed"),this},checkHeights:function(){var n=e(this),o=n.parent(".agmodal__wrapper"),r=e(window).height(),i=n.outerHeight();return r<i+110?o.removeClass("agmodal__wrapper--center"):t.center&&o.addClass("agmodal__wrapper--center"),this}};e(window).on("load",function(){var t,n,o,r;t=e("html"),n=e(window).width(),t.addClass("agmodal--lock-test"),o=e(window).width(),t.removeClass("agmodal--lock-test"),r=o-n,e("<style type='text/css'>.agmodal--lock{margin-right:"+r+"px !important;}</style>").appendTo("head")}),e(window).on("resize",function(){e(".agmodal--visible").agmodal("checkHeights")}),e(document).ready(function(){e("*[data-ag]").click(function(t){t.preventDefault();var n=e(this).attr("data-ag"),o=e("#"+n);o.agmodal("open")})}),e(document).on("agmodal.inited",function(){e(".agmodal__close").click(function(){e(this).parent(".agmodal").agmodal("close")}),e(".agmodal__wrapper").click(function(){e(this).find(".agmodal").agmodal("close")}).children().click(function(e){e.stopPropagation()})}),e.fn.agmodal=function(t){return n[t]?n[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Метод "+t+" в jQuery.agmodal не существует"):n.init.apply(this,arguments)}}(jQuery);